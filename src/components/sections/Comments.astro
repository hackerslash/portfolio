---
import Section from "../Section.astro"
---

<Section title="Comments">
  <div class="giscus-container">
    <script
      src="https://giscus.app/client.js"
      data-repo="hackerslash/portfolio"
      data-repo-id="R_kgDON-fBWA"
      data-category="General"
      data-category-id="DIC_kwDON-fBWM4CnvX1"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="transparent_dark"
      data-lang="en"
      data-loading="lazy"
      crossorigin="anonymous"
      async
    ></script>
  </div>
</Section>

<script>
  const updateGiscusTheme = () => {
    const theme = document.documentElement.classList.contains('light') ? 'light' : 'transparent_dark';
    const iframe = document.querySelector<HTMLIFrameElement>('iframe.giscus-frame');
    if (!iframe) return;

    iframe.contentWindow?.postMessage(
      { giscus: { setConfig: { theme } } },
      'https://giscus.app'
    );
  };

  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'class') {
        updateGiscusTheme();
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true });

  window.addEventListener('message', (event) => {
    if (event.origin !== 'https://giscus.app') return;
    if (!(typeof event.data === 'object' && event.data.giscus)) return;
    updateGiscusTheme();
  });
</script>

<style>
  .giscus-container {
    margin-top: 2rem;
    padding: 1rem;
    border-radius: 12px;
    border: 1px solid var(--card-border);
    background: var(--card-bg);
    backdrop-filter: blur(8px);
    min-height: 150px;
  }
</style>
